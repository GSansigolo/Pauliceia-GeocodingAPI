SELECT geometry, nf, nl, (6) AS num FROM (SELECT(SELECT ST_AsText(ST_Line_SubString(street, startfraction, endfraction)) as geometry FROM (SELECT(SELECT St_AsText(a.geom) FROM tb_street AS a WHERE a.name LIKE ('%avenida tiradentes%')) AS street, (SELECT ST_LineLocatePoint(line, point) FROM (SELECT(SELECT St_AsText(ST_LineMerge(a.geom)) AS street FROM tb_street AS a WHERE a.name LIKE ('%avenida tiradentes%')) AS line, (SELECT(SELECT ST_AsText(ST_ClosestPoint(line, pt)) FROM (SELECT (SELECT st_astext(a.geom) FROM tb_places AS a JOIN tb_street AS b ON a.id_street = b.id WHERE a.number = (SELECT MIN(number) FROM tb_places AS a JOIN tb_street AS b ON a.id_street = b.id WHERE b.name LIKE ('%avenida tiradentes%') AND a.number > (6) AND a.first_year >= (1931) AND a.last_year >= (1931) LIMIT 1) AND b.name LIKE ('%avenida tiradentes%')  ) As pt, (SELECT ST_AsText(geom) FROM tb_street WHERE name LIKE ('%avenida tiradentes%')) As line) As foo)) AS point)AS foo) AS startfraction, (SELECT ST_LineLocatePoint(line, point) FROM (SELECT(SELECT St_AsText(ST_LineMerge(a.geom)) AS street FROM tb_street AS a WHERE a.name LIKE ('%avenida tiradentes%')) AS line, (SELECT (SELECT ST_AsText(ST_ClosestPoint(line, pt)) FROM (SELECT (SELECT st_astext(a.geom) FROM tb_places AS a JOIN tb_street AS b ON a.id_street = b.id WHERE a.number = (SELECT MAX(number) FROM tb_places AS a JOIN tb_street AS b ON a.id_street = b.id WHERE b.name LIKE ('%avenida tiradentes%') AND a.number < (6) AND a.first_year >= (1931) AND a.last_year >= (1931) LIMIT 1) AND b.name LIKE ('%avenida tiradentes%')) As pt, (SELECT ST_AsText(geom) FROM tb_street WHERE name LIKE ('%avenida tiradentes%')) As line) As foo)) AS point) AS foo) AS endfraction) AS foo) AS geometry, (SELECT number_max FROM (SELECT (SELECT MIN(number) FROM tb_places AS a JOIN tb_street AS b ON a.id_street = b.id WHERE b.name LIKE ('%avenida tiradentes%') AND a.number > (6) AND a.first_year >= (1931) AND a.last_year >= (1931) LIMIT 1) as number_max) AS foo) As nf, (SELECT number_min FROM (SELECT (SELECT MAX(number) FROM tb_places AS a JOIN tb_street AS b ON a.id_street = b.id WHERE b.name LIKE ('%avenida tiradentes%') AND a.number < (6) AND a.first_year >= (1931) AND a.last_year >= (1931) LIMIT 1) as number_min) AS foo) AS nl) As foo;